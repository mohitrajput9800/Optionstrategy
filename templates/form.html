<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Option Strategy Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Inter', Arial, sans-serif;
      background: #171f2c;
      overflow-x: hidden;
    }
    /* Animated login background for login page only */
    .animated-bg {
      position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:0;
      background: linear-gradient(130deg, #67d1ff 0%, #2b5876 100%),
        url("https://www.transparenttextures.com/patterns/cubes.png");
      animation: bg-move 12s linear infinite alternate;
      background-size: 250% 250%, auto;
      opacity:0.92;
      transition: opacity .5s;
    }
    @keyframes bg-move {
      0% { background-position: 0 0, 0 0;}
      100% { background-position: 60% 40%, 0 0;}
    }
    .fadein-card {
      animation: fadein 1.3s cubic-bezier(.46,.03,.52,.96);
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(40px) scale(1.02);}
      to   { opacity: 1; transform: none;}
    }
    /* Trading chart background for dashboard only */
    .chart-bg {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
      background: #171f2c;
    }
    .chart-bg::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 1;
      opacity: 0.8;
      background:
        linear-gradient(120deg,#365072b0 10%,#7adcf4aa 90%,#171f2c 100%),
        url("data:image/svg+xml,%3Csvg width='1100' height='600' xmlns='http://www.w3.org/2000/svg'%3E%3Cg opacity='0.34'%3E%3Cpolyline points='50,560 110,340 190,410 270,320 350,170 470,350 690,190 890,450 1040,390' style='fill:none;stroke:%23ffa400;stroke-width:5;stroke-linecap:round;stroke-linejoin:round;'/%3E%3Cpolyline points='100,420 200,540 320,350 520,200 900,220' style='fill:none;stroke:%2350e07c;stroke-width:6;stroke-linecap:round;stroke-linejoin:round;'/%3E%3Crect x='110' y='340' width='15' height='65' rx='8' fill='%23fc4040'/%3E%3Crect x='350' y='170' width='18' height='58' rx='6' fill='%2335c430'/%3E%3Crect x='890' y='450' width='12' height='35' rx='5' fill='%23fc4040'/%3E%3C/g%3E%3Cg opacity='0.16'%3E%3Ctext x='200' y='380' font-size='17' fill='%23ffe487' font-family='Arial'%3E31,012%3C/text%3E%3Ctext x='500' y='240' font-size='21' fill='%2350e07c' font-family='Arial'%3E48,991%3C/text%3E%3Ctext x='1040' y='390' font-size='17' fill='%23ffe487' font-family='Arial'%3E44,870%3C/text%3E%3C/g%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center center;
      pointer-events: none;
    }
    @media (max-width:900px){
      .chart-bg::after{background-size:cover;}
    }
    @media (max-width:600px){
      .chart-bg::after{background-size:cover;}
    }
    .logo-rajput-animated {
      position: fixed;
      left: 15px;
      top: 15px;
      z-index: 100;
      width: 68px;
      height: 68px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(34,34,34,0.47);
      border-radius: 20px;
      box-shadow: 0 4px 20px #67d1ff79,0 0 0 3px #67d1ff31;
      padding: 9px;
      pointer-events: none;
      animation: pulse-glow 2.6s infinite;
    }
    .logo-rajput-animated img {
      width: 95%;
      height: 95%;
      object-fit: contain;
      opacity: 1;
      background: transparent;
      border-radius: 14px;
      box-shadow: 0 0 14px #67d1ffb7, 0 1px 22px #d6f5ffb7, 0 0 0 #67d1ff;
      animation: logo-glow 2.6s infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 4px 20px #67d1ff79,0 0 0 3px #67d1ff31;}
      50%      { box-shadow: 0 2px 38px #67d1ffdd,0 0 0 7px #9ae9ff45;}
    }
    @keyframes logo-glow {
      0%, 100% { box-shadow: 0 0 10px #67d1ffb7, 0 1px 16px #d6f5ffb7; }
      50%      { box-shadow: 0 0 48px #67d1ff, 0 2px 22px #c0eaffcc; }
    }
    @media (max-width:600px){
      .logo-rajput-animated{width:36px;height:36px;left:6px;top:6px;padding:2px;}
    }
    .datetime-bar {
      position: relative;
      z-index: 3;
      text-align: center;
      font-size: 1.04rem;
      background: rgba(250,255,255,0.54);
      box-shadow: 0 6px 18px #64d4e544;
      width: 100vw;
      padding: 7px 0 4px 0;
      font-family: 'Inter', Arial, sans-serif;
      color: #184175;
      font-weight: 600;
      letter-spacing: 0.07em;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #date-rajput { font-size: 0.95em; margin-bottom: 3px; }
    #time-rajput { font-size: 1.08em; letter-spacing: 0.05em; }
    .ticker-bar {
      width: 100vw;
      overflow: hidden;
      background: #f7fcff;
      box-shadow: 0 3px 12px #64d4e535;
      border-top: 1.5px solid #dde8ee;
      border-bottom: 1.5px solid #dde8ee;
      position: relative;
      z-index: 3;
      height: 42px;
    }
    .ticker-track {
      display: flex;
      align-items: center;
      gap: 24px;
      height: 42px;
      animation: ticker-scroll 30s linear infinite;
    }
    .ticker-item {
      font-family: 'Inter', Arial, sans-serif;
      color: #184175;
      font-size: 1.04rem;
      font-weight: 600;
      padding: 0 13px;
      border-right: 2px solid #e3f3f7;
      display: flex;
      align-items: center;
      min-width: 160px;
      white-space: nowrap;
      background: #f7fcff;
    }
    .ticker-item:last-child{border:none;}
    .up{color:#0aa869;font-weight:700;}
    .down{color:#e9176e;font-weight:700;}
    .idx-symbol{color:#227773;font-weight:700;font-size:1em;margin-right:6px;}
    @keyframes ticker-scroll{0%{transform:translateX(0);}100%{transform:translateX(-53%);}}
    .container {
      max-width: 650px;
      margin: 90px auto 36px auto;
      background: #ffffffcc;
      border-radius: 24px;
      box-shadow: 0 8px 38px #86c0e934;
      padding: 36px 24px 32px 24px;
      position: relative;
      z-index: 3;
      backdrop-filter: blur(2.5px);
    }
    form { width: 100%; }
    .row {
      display: flex;
      gap: 22px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }
    .col {
      flex: 1;
      min-width: 210px;
      display: flex;
      flex-direction: column;
      margin-bottom: 6px;
    }
    label {
      color: #229ebe;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 1rem;
    }
    input, select {
      font-size: 1.06rem;
      border: 1.45px solid #bdeff9;
      border-radius: 8px;
      padding: 11px 12px;
      background: #f6fbfc;
      color: #227773;
      outline: none;
      margin-bottom: 1px;
      transition: border 0.18s;
    }
    input:focus, select:focus {
      border-color: #44e7bc;
      background: #ecfff7;
    }
    input[readonly] {
      background: #eeeeee;
      color: #82a2aa;
    }
    .actions {
      text-align: center;
      margin-top: 27px;
    }
    button {
      background: linear-gradient(90deg, #43e7bc 40%, #36aebb 100%);
      color: #fff;
      font-size: 1.14rem;
      font-family: inherit;
      border-radius: 50px;
      border: none;
      padding: 13px 48px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.5px;
      box-shadow: 0 6px 18px #79e7e722;
      transition: background 0.18s, transform 0.13s;
    }
    button:hover {
      background: linear-gradient(90deg, #41d8be 30%, #158ced 90%);
      transform: translateY(-2px) scale(1.030);
    }
    .note {
      color: #128973;
      font-size: 0.99rem;
      margin: 3px 0 17px 0;
      text-align: center;
    }
    footer {
      text-align: center;
      font-size: 1.01rem;
      background: linear-gradient(90deg,#4fa7ee 0%,#96f1cd 100%);
      color: #1c464b;
      margin-top: 38px;
      letter-spacing: 0.3px;
      font-weight: 400;
      z-index: 2;
      position: relative;
      padding:10px 0;
    }
    @media (max-width:700px){
      .container{padding:15px 2vw;margin:73px auto 15px auto;}
    }
    @media (max-width:500px){
      .container{padding:5px 0;}
      .col{min-width:140px;}
    }
  </style>
</head>
<body>
{% if not logged_in %}
  <div class="animated-bg"></div>
  <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;">
    <form class="fadein-card" action="/login" method="POST"
      style="background:rgba(23,34,54,0.88);backdrop-filter:blur(9px);padding:40px 32px 35px 32px;border-radius:28px;
        box-shadow:0 10px 44px #23325f60;max-width:355px;width:90vw;position:relative;
        border:2.3px solid; border-image: linear-gradient(110deg,#67d1ff 0%,#36aebb 100%) 1;">
      <div style="display:flex;justify-content:center;align-items:center;margin-bottom:16px;">
        <span style="display:inline-block;width:53px;height:53px;border-radius:14px;
          background:linear-gradient(132deg,#67d1ff 60%,#b2e5fa 100%);
          box-shadow:0 7px 26px #67d1ff61,0 2px 6px #67d1ff33;">
          <svg style="width:51px;height:51px;vertical-align:middle;" viewBox="0 0 64 64" fill="none">
            <circle cx="32" cy="32" r="29.5" stroke="#36aebb" stroke-width="3.5"/>
            <path d="M32 18a8 8 0 1 1 0 16 8 8 0 0 1 0-16zm0 17c7 0 13 3 13 8.5V50H19v-6.5C19 38 25 35 32 35z"
                  fill="#67d1ff" stroke="#136ea8" stroke-width="1.5" />
          </svg>
        </span>
      </div>
      <h2 style="color:#54caff;text-align:center;margin:0 0 18px 0;font-family:'Inter',Arial,sans-serif;letter-spacing:0.10em;font-weight:800;">
        Option Strategy Dashboard
      </h2>
      <input type="password" name="password" placeholder="Enter your password" autocomplete="off"
        style="width:97%;margin-bottom:19px;font-size:1.13em;padding:14px 14px 12px 14px;border-radius:12px;
        border:1.6px solid #93e5ff;background:rgba(255,255,255,0.06);color:#4db2e1;box-shadow:0 2px 8px #67d1ff16;">
      <button type="submit"
        style="width:100%;background:linear-gradient(90deg,#67d1ff 40%,#36aebb 100%);color:#fff;font-size:1.14em;
        font-family:inherit;border-radius:15px;border:none;padding:12px 0;cursor:pointer;
        font-weight:800;letter-spacing:0.08em;box-shadow:0 4px 16px #aeefff33;">
        <span style="display:inline-block;vertical-align:middle;filter:drop-shadow(0 0 10px #67d1ff77);margin-right:4px;">ðŸ”’</span>
        Login Securely
      </button>
      <div style="margin-top:12px;color:#eb5252;text-align:center;font-size:1.08em;min-height:1.2em;letter-spacing:0.09em;">
        {{ error if error }}
      </div>
      <div style="margin-top:27px;text-align:center;color:#cde3f0;font-size:0.98em;letter-spacing:0.02em;">
        For authorized users only.<br> Your session is private and encrypted.
      </div>
    </form>
  </div>
{% else %}
  <div class="chart-bg"></div>
  <div class="logo-rajput-animated">
    <img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/30a21fb5-200c-45ef-93b8-f5fdc17c0bd3.png" alt="Rajput Trading Logo">
  </div>
  <div class="datetime-bar">
    <div id="date-rajput"></div>
    <div id="time-rajput"></div>
  </div>
  <div class="ticker-bar" id="ticker">
    <div class="ticker-track">
      <div class="ticker-item"><span class="idx-symbol">NIFTY 50</span> <span class="index-value">24631.30</span> <span class="up">+80.40 (0.33%)</span></div>
      <div class="ticker-item"><span class="idx-symbol">NIFTY Bank</span> <span class="index-value">55341.85</span> <span class="up">+190.75 (0.35%)</span></div>
      <div class="ticker-item"><span class="idx-symbol">SENSEX</span> <span class="index-value">80597.66</span> <span class="down">-45.60 (-0.06%)</span></div>
      <div class="ticker-item"><span class="idx-symbol">FINNIFTY</span> <span class="index-value">22831.15</span> <span class="down">-21.60 (-0.09%)</span></div>
      <div class="ticker-item"><span class="idx-symbol">MIDCAP</span> <span class="index-value">59721.21</span> <span class="up">+102.55 (0.17%)</span></div>
    </div>
  </div>
  <div style="margin-top:20px"></div>
  <div class="container">
    <!-- Full option strategy form as before -->
    <form method="post" action="/generate">
      <div class="note">Fields auto-update for your selected script and mode.</div>
      <div class="row">
        <div class="col">
          <label for="legs">Legs</label>
          <select id="legs" name="legs" onchange="updateLotSize()">
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div class="col">
          <label for="ratio">Ratio (e.g. 1.5.4)</label>
          <input type="text" id="ratio" name="ratio" value="1.5.4" required onchange="updateLotSize()">
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="script">Script</label>
          <select id="script" name="script" onchange="updateStrikeFields();updateLotSize();">
            <option value="NIFTY">NIFTY</option>
            <option value="BANKNIFTY">BANKNIFTY</option>
            <option value="SENSEX">SENSEX</option>
            <option value="MIDCAP">MIDCAP</option>
            <option value="FINNIFTY">FINNIFTY</option>
          </select>
        </div>
        <div class="col">
          <label for="expiry">Expiry</label>
          <input type="date" id="expiry" name="expiry" required>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="firstStrikeCE">First Strike CE</label>
          <input type="number" id="firstStrikeCE" name="firstStrikeCE" value="24100" required>
        </div>
        <div class="col">
          <label for="firstStrikePE">First Strike PE</label>
          <input type="number" id="firstStrikePE" name="firstStrikePE" value="25400" required>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="strikeStep">Strike Step</label>
          <input type="number" id="strikeStep" name="strikeStep" value="50" required>
        </div>
        <div class="col">
          <label for="legGap">Leg Gap (comma separated)</label>
          <input type="text" id="legGap" name="legGap" value="250" required>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="totStrikes">Total Strike Rows</label>
          <input type="number" id="totStrikes" name="totStrikes" value="10" required>
        </div>
        <div class="col">
          <label for="buySellPattern">Buy/Sell Pattern (e.g. S.B.S)</label>
          <input type="text" id="buySellPattern" name="buySellPattern" value="S.B.S" required>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="fileName">File Name</label>
          <input type="text" id="fileName" name="fileName" value="NIFTY-strategy.csv">
        </div>
        <div class="col">
          <label for="lotSize">Lot Size</label>
          <input type="text" id="lotSize" name="lotSize" value="75" required readonly>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="mode">Mode</label>
          <select id="mode" name="mode" onchange="updateLotSize()">
            <option value="8184">8184</option>
            <option value="7155">7155</option>
            <option value="IOC">IOC</option>
          </select>
        </div>
      </div>
      <div class="actions">
        <button type="submit">Download CSV</button>
      </div>
    </form>
    <form action="/logout" method="post" style="margin-top:2em;">
      <button type="submit" style="padding:9px 25px;border-radius:7px;background:#d6f5ff;color:#126793;font-weight:700;font-size:1.09em;border:none;">Logout</button>
    </form>
  </div>
  <footer>
    &copy; 2025 Option Strategy Dashboard
  </footer>
  <script>
    function updateStrikeFields() {
      const script = document.getElementById('script').value;
      let ce = 24100, pe = 25400;
      if (script === "BANKNIFTY") { ce = 50000; pe = 49000; }
      else if (script === "SENSEX") { ce = 80000; pe = 78000; }
      else if (script === "MIDCAP") { ce = 12000; pe = 11000; }
      else if (script === "FINNIFTY") { ce = 26000; pe = 25000; }
      document.getElementById('firstStrikeCE').value = ce;
      document.getElementById('firstStrikePE').value = pe;
    }
    function updateLotSize() {
      const mode = document.getElementById('mode').value;
      let ratio = document.getElementById('ratio').value;
      let script = document.getElementById('script').value;
      let lotPerScript = 75;
      if (script === "BANKNIFTY") lotPerScript = 35;
      else if (script === "SENSEX") lotPerScript = 20;
      else if (script === "MIDCAP") lotPerScript = 140;
      else if (script === "FINNIFTY") lotPerScript = 65;
      let lotValue;
      if (mode === "7155") {
        let pieces = ratio.split('.').filter(x => x).length;
        lotValue = Array(pieces).fill(lotPerScript).join('|');
      } else {
        lotValue = lotPerScript;
      }
      document.getElementById('lotSize').value = lotValue;
    }
    function setExpiryToday() {
      var d = new Date();
      var yyyy = d.getFullYear();
      var mm = ('0' + (d.getMonth() + 1)).slice(-2);
      var dd = ('0' + d.getDate()).slice(-2);
      var today = yyyy + '-' + mm + '-' + dd;
      document.getElementById('expiry').value = today;
    }
    function updateDateTimeVertical() {
      const dt = new Date();
      let date = dt.toLocaleDateString(undefined, {month:'long',day:'numeric',year:'numeric'});
      let hour = dt.getHours();
      let minute = dt.getMinutes();
      let second = dt.getSeconds();
      let pad = n => n<10?"0"+n:n;
      let time = `${pad(hour)}:${pad(minute)}:${pad(second)}`;
      document.getElementById('date-rajput').textContent = date;
      document.getElementById('time-rajput').textContent = time;
    }
    window.onload = function() {
      if (document.getElementById('expiry')) setExpiryToday();
      if (document.getElementById('firstStrikeCE')) updateStrikeFields();
      if (document.getElementById('lotSize')) updateLotSize();
      updateDateTimeVertical();
    };
    setInterval(updateDateTimeVertical, 1000);
    // DEMO: Auto update ticker with random data
    function randomValue(base) {
      return (base + (Math.random() - 0.5) * base * 0.01).toFixed(2);
    }
    function randomChange(base) {
      let up = Math.random() > 0.5;
      let chg = (Math.random() * 200 - 100).toFixed(2);
      let pct = (Math.abs(chg) / base * 100).toFixed(2);
      return {
        up: up,
        chg: (up ? "+" : "") + chg,
        pct: (up ? "+" : "") + pct
      };
    }
    setInterval(() => {
      const items = document.querySelectorAll('.ticker-item');
      let bases = [24631, 55341, 80597, 22831, 59721];
      items.forEach((item, i) => {
        let val = randomValue(bases[i]);
        let move = randomChange(bases[i]);
        item.querySelector('.index-value').textContent = val;
        let moveEl = item.querySelector('.up, .down');
        moveEl.textContent = `${move.chg} (${move.pct}%)`;
        moveEl.className = move.up ? 'up' : 'down';
      });
    }, 5000);
  </script>
{% endif %}
</body>
</html>
